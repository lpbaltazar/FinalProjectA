SELECT USERID, SESSIONID, EXTRACT(YEAR_MONTH FROM SESSION_STARTDT) AS MONTH, YEARWEEK(SESSION_STARTDT, 1) AS WEEK, DATE(SESSION_STARTDT) AS DATE, ((VIDEO_DURATION*1.0)/(USR_ACT_TOT_WATCHING_DUR*1.0))*100 AS COMPLETION_70
FROM events_data
WHERE ((VIDEO_DURATION*1.0)/(USR_ACT_TOT_WATCHING_DUR*1.0)) >= 0.70
INTO OUTFILE '/var/lib/mysql-files/for_completion_total.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';

SELECT EXTRACT(YEAR_MONTH FROM SESSION_STARTDT) AS MONTH, USERID, SESSIONID, VIDEO_DURATION, USR_ACT_TOT_WATCHING_DUR 
FROM events_data
GROUP BY EXTRACT(YEAR_MONTH FROM SESSION_STARTDT)
INTO OUTFILE '/var/lib/mysql-files/for_completion_monthly.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';

SELECT YEARWEEK(SESSION_STARTDT) AS WEEK, USERID, SESSIONID, VIDEO_DURATION, USR_ACT_TOT_WATCHING_DUR
FROM events_data
GROUP BY YEARWEEK(SESSION_STARTDT)
INTO OUTFILE '/var/lib/mysql-files/for_completion_weekly.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';

